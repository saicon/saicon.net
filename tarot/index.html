<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pet-Inspired Tarot — Your Spirit Guide</title>
  <meta name="description" content="Upload your pet, choose a theme, and receive a light-hearted 3-card tarot reading with your pet as your spirit guide." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="page">  
    <section class="layout">
      <!-- Preview cards -->
      <div class="cards">
        <!-- Hero -->
        <header class="hero">
          <div class="logo_layout">
            <hr>
            <img class="logo" src="assets/topcat.png" alt="" />
            <hr>
          </div>
          <h1 class="hero__title">Your Pet, Your Spirit Guide</h1>
          <p class="hero__lead">
            Transform your beloved pet to a spirit guide within the tarot, inspiring Major Arcana cards to reveal past, present, and future. Through their essence, the cards offer gentle insight and guidance for your journey ahead.
          </p>
        </header>
        <!-- Replace the three image src values with your generated card artwork -->
        <figure class="tarot">
          <img src="assets/3TaroCards.png" alt="pet-inspired tarot cards" />
        </figure>
      </div>
      <!-- Form panel -->
      <aside class="panel">
        <form
          id="tarotForm"
          class="form"
          action="https://n8n.saicon.net/webhook-test/tarot"  
          method="POST"
          enctype="multipart/form-data"
          novalidate
        >
          <h3 class="form__title">Get a Tarot insight</h3>

          <label class="field">
            <span class="label">Name</span>
            <input class="input" type="text" name="name" placeholder="Your name" autocomplete="name" />
          </label>

          <label class="field">
            <span class="label">Email*</span>
            <input class="input" type="email" name="email" placeholder="Your email" autocomplete="email" />
          </label>

          <label class="field">
            <span class="label">Theme*</span>
            <div class="select-wrap">
              <select class="input select" name="theme" required>
                <option value="general" selected>General</option>
                <option value="career">Career</option>
                <option value="love">Love</option>
                <option value="finance">Finance</option>
                <option value="wellbeing">Wellbeing</option>
              </select>
              <svg class="chev" viewBox="0 0 16 16" aria-hidden="true"><path d="M4 6l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </div>
          </label>

          <label class="field">
            <span class="label">Image of your pet*</span>
            <!-- Keep name=image0 so n8n receives it at $binary.image0 -->
            <div class="file">
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5-5 5 5M12 5v14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Choose an image</span>
              <input id="petUpload" class="file__input" type="file" name="image0" accept="image/*" required />
              <div id="previewBox">
                <img id="previewImg" src="" alt="Pet preview" style="display:none;" />
              </div>
            </div>
          </label>
          <button id="submitBtn" class="button" type="submit">Get a reading</button>
        </form>
      </aside>
    </section>
    <!-- Popup Modal -->
  <div id="popup" class="popup">
    <div class="popup-content">
      <span id="popupClose">&times;</span>
      <p id="popupMessage">Please enter all required fields</p>
    </div>
  </div>
    <footer class="site-footer">
      <img class="logo" src="assets/PetInspiredTarot.png" alt="" />
      <p>Pet-Inspired Tarot © 2025 · AI generated cards and prediction for entertainment purposes only</p>
    </footer>
  </main>
<!-- ...rest of your HTML above... -->
<script>
  // Image preview logic (unchanged)
  const fileInput = document.getElementById('petUpload');
  const previewImg = document.getElementById('previewImg');
  fileInput.addEventListener('change', function () {
    const file = this.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function (e) {
        previewImg.src = e.target.result;
        previewImg.style.display = 'block';
      };
      reader.readAsDataURL(file);
    } else {
      previewImg.src = "";
      previewImg.style.display = 'none';
    }
  });

  // Form validation and submit
  const form = document.getElementById("tarotForm");
  const submitBtn = document.getElementById("submitBtn");
  const popup = document.getElementById("popup");
  const popupMsg = document.getElementById("popupMessage");
  const popupClose = document.getElementById("popupClose");

  form.addEventListener("submit", async function(e) {
    e.preventDefault();
    let allValid = true;

    // Only validate required fields
    const emailInput  = form.elements["email"];
    const themeInput  = form.elements["theme"];
    const imageInput  = form.elements["image0"];

    // Remove all previous errors
    document.querySelectorAll(".field-error").forEach(el => el.remove());
    [emailInput, themeInput, imageInput].forEach(input => input.classList.remove("input-error"));

    // Validate Email ONLY on submit
    if (!emailInput.value.trim() || !/\S+@\S+\.\S+/.test(emailInput.value)) {
      showError(emailInput, "Please enter a valid email address.");
      allValid = false;
    }

    // Validate Theme
    if (!themeInput.value.trim()) {
      showError(themeInput, "Please select a theme.");
      allValid = false;
    }

    // Validate Image
    if (!imageInput.files || !imageInput.files[0]) {
      showUploadError(imageInput, "Please upload an image of your pet.");
      allValid = false;
    }

    if (!allValid) {
      popupMsg.textContent = "Please fill in all required fields.";
      popup.classList.add("open");
      return;
    }

    // All fields valid, disable button and show spinner
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<div class="spinner"></div>';

    // Submit to webhook
    const formData = new FormData(form);
    try {
      const res = await fetch(form.action, { method: "POST", body: formData });
      const text = await res.text();
      popupMsg.textContent = text || "Your reading request has been sent!";
      popup.classList.add("open");
    } catch {
      popupMsg.textContent = "Something went wrong. Please try again. Note: Your photo cannot be a human :)";
      popup.classList.add("open");
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = "Get a reading";
    }
  });

  // Helper for errors below the input
  function showError(input, message) {
    let error = document.createElement("div");
    error.className = "field-error";
    error.textContent = message;
    input.classList.add("input-error");
    input.parentNode.appendChild(error);
  }

  // Helper for upload error: after the .file box, inside parent field container
  function showUploadError(input, message) {
    let error = document.createElement("div");
    error.className = "field-error";
    error.textContent = message;
    input.classList.add("input-error");
    // Find the label.field wrapping the image input
    let fieldLabel = input.closest("label.field");
    let fileBox = input.closest(".file");
    if (fieldLabel && fileBox) {
      // Insert error after the file box, but still inside the label.field
      fieldLabel.insertBefore(error, fileBox.nextSibling);
    }
  }

  // Popup close logic
  popupClose.onclick = () => popup.classList.remove("open");
  popup.onclick = (e) => { if (e.target === popup) popup.classList.remove("open"); };
</script>
</body>
</html>
